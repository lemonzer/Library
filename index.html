<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width">
    <title>Library</title>
  </head>

  <body>
    <button popovertarget="form">Open dialog</button>
    <dialog id="form" popover>
  <p>
    <label for="title">Title:</label>
    <input type="text" id="title" name="book_title" />
  </p>
  <p>
    <label for="author">Author:</label>
    <input type="text" id="author" name="book_author" />
  </p>
  <p>
    <label for="pages">Pages:</label>
    <input type="text" id="pages" name="book_pages"></textarea>
  </p>
  <label for="options">Choose an option:</label>
<select id="options" name="options">
  <option value="read">Read</option>
  <option value="unread">Unread</option>
</select>
<p class="button">
  <button type="button" onclick="addBookToLibrary()">Save book info</button>
</p>
</dialog>




<div id="result"></div>
    
    <script>
      
const myLibrary = [];      

function Book(title, author, pages, option, id) {

  if (!new.target) {
    throw Error("You must use the 'new' operator to call the constructor");
  }
  this.title = title;
  this.author = author;
  this.pages = pages;
  this.option = option;
  this.id = id;
  };






  function addBookToLibrary () {

      const input1 = document.getElementById('title').value;
      const input2 = document.getElementById('author').value;
      const input3 = document.getElementById('pages').value;
      const input4 = document.getElementById('options').value;
      const input5 = crypto.randomUUID()
      
      const sameTitle = myLibrary.find(item => item.title.toLowerCase() === input1.toLowerCase());

      if (input1 !== "" && input2 !== "" && input3 !== "" && !sameTitle) {
      myLibrary.push(new Book(input1, input2, input3, input4, input5));
      }
      displayArray();
  }

    function displayArray () {
    const resultDiv = document.getElementById("result");
    
    // Clear previous content if any (optional, useful if clicking multiple times)
    resultDiv.innerHTML = ''; 
    
    myLibrary.forEach(element => {
        const itemDiv = document.createElement("div"); 
        const selectButton = document.createElement("button");
        const removeButton = document.createElement("button");
        
        itemDiv.innerHTML = `Title: ${element.title}, Author: ${element.author}, Pages: ${element.pages}, Option: ${element.option}, ID: ${element.id}`;

        removeButton.textContent = "Remove";
        removeButton.id = element.id;

        selectButton.id = element.id;
        selectButton.textContent = element.option;

        const index = myLibrary.findIndex(item => item.id === removeButton.id);

        selectButton.addEventListener("click", () => {
          
              if (element.option === "read") {
              element.option = "unread";
              } else if (element.option === "unread") {
              element.option = "read";
              }
              
          displayArray();
        })
        /*
        myLibrary.forEach(optionData => {
        const optionSelect =  document.createElement('option');
          
        optionSelect.value = this.option;
        optionSelect.text = this.option;

        selectRead.append(optionSelect);
        });
        */


        removeButton.addEventListener("click", () => {
          if (index !== -1) {
          myLibrary.splice(index, 1);
          
          displayArray();
          }
        })

        resultDiv.appendChild(itemDiv); 
        resultDiv.appendChild(selectButton);
        resultDiv.appendChild(removeButton);
        
    });
    }


    </script>
  </body>

</html>